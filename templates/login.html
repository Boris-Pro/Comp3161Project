{% extends 'base.html' %}

{% block title %}Login - VLE{% endblock %}

{% block content %}
<h1>Login</h1>

<form id="loginForm">
    <label for="user_id">User ID:</label>
    <input type="text" id="user_id" placeholder="Enter your user ID" required><br>

    <label for="user_password">Password:</label>
    <input type="password" id="user_password" placeholder="Enter your password" required><br>

    <button type="submit">Login</button>
</form>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $('#loginForm').submit(function(e) {
        e.preventDefault();
        
        let data = {
            user_id: $('#user_id').val(),
            user_password: $('#user_password').val(),
        };

        $.ajax({
            url: '/auth/login',
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(data),
            success: function(response) {
                // Token is stored in a cookie
                alert('Login successful');
                
                // Redirect to the protected route
                window.location.href = '/auth/protected';  
            },
            error: function(response) {
                alert('Error: ' + response.responseJSON.message);
            }
        });
    });
</script>

{% endblock %}
